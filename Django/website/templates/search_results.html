{% extends "layout.html" %}
{% load custom_templatetags_art %}
{% block title %} Search Results {% endblock %}

{% block body %}

{% if request.GET.q != "" %}
<h1 class="display-3 text center">Results for:  '{{ request.GET.q }}'</h1>

<div class="card-columns">
  {% for art in object_list %}

  <!--Card-->
  <div id="art_item" class="card card-cascade card-ecommerce narrower mt-2 ">
    <!--Card image-->
    <div class="view view-cascade overlay">
      <img class="card-img-top" src="{{ art.artwork_photo.url }}"
      alt="artwork">
      <a>
        <div class="mask rgba-white-slight"></div>
      </a>
    </div>
    <!--/.Card image-->
    <!--Card content-->
    <div class="card-body card-body-cascade ">
      <!--Category & Title-->
      <h4 class="card-title text-center"><strong><a href="{% url 'artDetail_page' art.id %}">{{ art.artwork_name }}</a></strong></h4>
      <!--Description-->
      <p class="card-text">{{art.artwork_description }}</p>
      <!--Card footer-->
      <div class="card-footer mb-2">
        <span class="float-left">
          <a class="" data-toggle="tooltip" data-placement="top" title="Add a commint"><img class="rounded-circle article-img"  src="{{ art.artist.user.userprofile.image.url }}"></a>
        </span>
        <span class="float-left ml-3">
          <a href="#">{{ art.artist.user.username }}</a>
        </span>
        <span class="float-right" >
            <form id = "form-id"  >
                {% csrf_token %}
                <a class="like_button button"type="submit" onclick="{% if user.is_authenticated %}like_button({{art.id}}){% endif %}" onload="heart_sign_color()" > <i id="heart_sign_color_{{art.id}}"class="fas fa-heart {%isLiked art.id user.id%}" ></i></a>
            </form>
        </span>
        <span class="float-right" >
        <p id="like_count_{{artwork.id}}"class= "mr-1">{{art.artwork_likes.count}}</p>
        </span>
        <span class="float-right">
          <a  class="" data-toggle="tooltip" data-placement="top" title="Add a comment"><i class="far fa-comments mr-3"></i></a>
        </span>

      </div>
    </div>
    <!--/.Card content-->
  </div>
  <!--/.Card-->

  {% endfor %}


</div>

{% else %}
    <h1>No search results for this query.<h1/>
{% endif %}

{% endblock body %}

{% block javascript %}


<script>

  function like_button(id){
    var post_url ="{% url 'home_page' %}"
    $.ajax({
      type: 'POST',
      url: post_url,
      data: {
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
        'id':id,
      },
      success: LikePost,
      dataType: 'html'
    });
    function LikePost(data) {
      var data = $.parseJSON(data)
      if (data['liked']) {
        $('#heart_sign_color_'+data['art_pk']).addClass('text-danger')
        $('#like_count_'+data['art_pk']).text(data['like_count'])
      }
      else
      {
        $('#heart_sign_color_'+data['art_pk']).removeClass('text-danger')
        $('#like_count_'+data['art_pk']).text(data['like_count'])
      }
    };
  };


</script>
{% endblock %}

